{"ast":null,"code":"import React,{useState,useEffect}from'react';import api from'../../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const AdminMattermost=()=>{const[stats,setStats]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[successMessage,setSuccessMessage]=useState(null);const[syncing,setSyncing]=useState(false);const[testing,setTesting]=useState(false);const[cycles,setCycles]=useState([]);const[selectedCycle,setSelectedCycle]=useState(null);const[sendingNotification,setSendingNotification]=useState(false);useEffect(()=>{loadData();},[]);const loadData=async()=>{try{setLoading(true);const[statsResponse,cyclesResponse]=await Promise.all([api.get('/mattermost/integration-stats'),api.get('/cycles').catch(()=>({data:[]}))]);setStats(statsResponse.data);setCycles(cyclesResponse.data.filter(cycle=>cycle.status==='active'));}catch(error){console.error('Ошибка загрузки данных:',error);setError('Не удалось загрузить данные интеграции');}finally{setLoading(false);}};const handleTestConnection=async()=>{try{setTesting(true);const response=await api.get('/mattermost/test-connection');if(response.data.connected){setSuccessMessage('Подключение к Mattermost работает корректно');}else{setError('Не удалось подключиться к Mattermost');}loadData();// Обновляем статистику\n}catch(error){var _error$response,_error$response$data;console.error('Ошибка тестирования подключения:',error);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Ошибка тестирования подключения');}finally{setTesting(false);}};const handleSyncUsers=async()=>{try{setSyncing(true);const response=await api.post('/mattermost/sync-users');if(response.data.success){setSuccessMessage(response.data.message);loadData();// Обновляем статистику\n}else{setError(response.data.error||'Ошибка синхронизации пользователей');}}catch(error){var _error$response2,_error$response2$data;console.error('Ошибка синхронизации пользователей:',error);setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Ошибка синхронизации пользователей');}finally{setSyncing(false);}};const handleSendCycleNotification=async cycleId=>{try{setSendingNotification(true);const response=await api.post(`/mattermost/notify-cycle-start/${cycleId}`);if(response.data.success){setSuccessMessage(response.data.message);}else{setError(response.data.error||'Ошибка отправки уведомлений');}}catch(error){var _error$response3,_error$response3$data;console.error('Ошибка отправки уведомлений:',error);setError(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'Ошибка отправки уведомлений');}finally{setSendingNotification(false);}};const handleSendRespondentNotifications=async cycleId=>{try{setSendingNotification(true);const response=await api.post(`/mattermost/notify-respondents/${cycleId}`);if(response.data.success){setSuccessMessage(response.data.message);}else{setError(response.data.error||'Ошибка отправки уведомлений');}}catch(error){var _error$response4,_error$response4$data;console.error('Ошибка отправки уведомлений:',error);setError(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.error)||'Ошибка отправки уведомлений');}finally{setSendingNotification(false);}};const handleSendReminders=async cycleId=>{try{setSendingNotification(true);const response=await api.post(`/mattermost/send-reminders/${cycleId}`);if(response.data.success){setSuccessMessage(response.data.message);}else{setError(response.data.error||'Ошибка отправки напоминаний');}}catch(error){var _error$response5,_error$response5$data;console.error('Ошибка отправки напоминаний:',error);setError(((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.error)||'Ошибка отправки напоминаний');}finally{setSendingNotification(false);}};// Очистка сообщений через 5 секунд\nuseEffect(()=>{if(successMessage||error){const timer=setTimeout(()=>{setSuccessMessage(null);setError(null);},5000);return()=>clearTimeout(timer);}},[successMessage,error]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"md:flex md:items-center md:justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold leading-7 text-gray-900 dark:text-white sm:text-3xl sm:truncate\",children:\"\\u0418\\u043D\\u0442\\u0435\\u0433\\u0440\\u0430\\u0446\\u0438\\u044F \\u0441 Mattermost\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500 dark:text-gray-400\",children:\"\\u0423\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0442\\u0435\\u0433\\u0440\\u0430\\u0446\\u0438\\u0435\\u0439 \\u0438 \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F\\u043C\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 Mattermost\"})]})}),successMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded\",children:successMessage}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 shadow rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-5 sm:p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900 dark:text-white\",children:\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441 \\u043F\\u043E\\u0434\\u043A\\u043B\\u044E\\u0447\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:`flex-shrink-0 w-3 h-3 rounded-full ${(stats===null||stats===void 0?void 0:stats.connectionStatus)==='connected'?'bg-green-500':'bg-red-500'}`}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900 dark:text-white\",children:(stats===null||stats===void 0?void 0:stats.connectionStatus)==='connected'?'Подключено':'Отключено'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 dark:text-gray-400\",children:(stats===null||stats===void 0?void 0:stats.connectionStatus)==='connected'?'Последняя синхронизация: '+((stats===null||stats===void 0?void 0:stats.lastSync)||'никогда'):''})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleTestConnection,disabled:testing,className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:testing?'Тестирование...':'Тестировать подключение'})})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 shadow rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-5 sm:p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900 dark:text-white\",children:\"\\u0421\\u0438\\u043D\\u0445\\u0440\\u043E\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-5 sm:grid-cols-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 dark:text-gray-400\",children:\"\\u0412\\u0441\\u0435\\u0433\\u043E \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"mt-1 text-2xl font-semibold text-gray-900 dark:text-white\",children:(stats===null||stats===void 0?void 0:stats.users.total)||0})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 dark:text-gray-400\",children:\"\\u0421 Mattermost\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"mt-1 text-2xl font-semibold text-gray-900 dark:text-white\",children:(stats===null||stats===void 0?void 0:stats.users.withMattermost)||0})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 dark:text-gray-400\",children:\"\\u041F\\u0440\\u043E\\u0446\\u0435\\u043D\\u0442 \\u0441\\u0438\\u043D\\u0445\\u0440\\u043E\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsxs(\"dd\",{className:\"mt-1 text-2xl font-semibold text-gray-900 dark:text-white\",children:[(stats===null||stats===void 0?void 0:stats.users.syncPercentage)||0,\"%\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleSyncUsers,disabled:syncing,className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:syncing?'Синхронизация...':'Синхронизировать пользователей'})})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 shadow rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-5 sm:p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900 dark:text-white\",children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430 \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u0439\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 gap-5 sm:grid-cols-2\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0446\\u0438\\u043A\\u043B \\u043E\\u0446\\u0435\\u043D\\u043A\\u0438\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedCycle||'',onChange:e=>setSelectedCycle(e.target.value?parseInt(e.target.value):null),className:\"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0446\\u0438\\u043A\\u043B...\"}),cycles.map(cycle=>/*#__PURE__*/_jsx(\"option\",{value:cycle.id,children:cycle.title||cycle.name},cycle.id))]})]})}),selectedCycle&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSendCycleNotification(selectedCycle),disabled:sendingNotification,className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:sendingNotification?'Отправка...':'Уведомить о запуске цикла'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSendRespondentNotifications(selectedCycle),disabled:sendingNotification,className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:sendingNotification?'Отправка...':'Уведомить респондентов'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSendReminders(selectedCycle),disabled:sendingNotification,className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:sendingNotification?'Отправка...':'Отправить напоминания'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0423\\u0432\\u0435\\u0434\\u043E\\u043C\\u0438\\u0442\\u044C \\u043E \\u0437\\u0430\\u043F\\u0443\\u0441\\u043A\\u0435 \\u0446\\u0438\\u043A\\u043B\\u0430:\"}),\" \\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u044F\\u0435\\u0442 \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F \\u0432\\u0441\\u0435\\u043C \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0430\\u043C \\u0446\\u0438\\u043A\\u043B\\u0430 \\u043E \\u043D\\u0430\\u0447\\u0430\\u043B\\u0435 \\u043E\\u0446\\u0435\\u043D\\u043A\\u0438\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0423\\u0432\\u0435\\u0434\\u043E\\u043C\\u0438\\u0442\\u044C \\u0440\\u0435\\u0441\\u043F\\u043E\\u043D\\u0434\\u0435\\u043D\\u0442\\u043E\\u0432:\"}),\" \\u041F\\u0435\\u0440\\u0441\\u043E\\u043D\\u0430\\u043B\\u044C\\u043D\\u044B\\u0435 \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F \\u0440\\u0435\\u0441\\u043F\\u043E\\u043D\\u0434\\u0435\\u043D\\u0442\\u0430\\u043C \\u043E \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E\\u0441\\u0442\\u0438 \\u043F\\u0440\\u043E\\u0439\\u0442\\u0438 \\u043E\\u0446\\u0435\\u043D\\u043A\\u0443\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u043D\\u0430\\u043F\\u043E\\u043C\\u0438\\u043D\\u0430\\u043D\\u0438\\u044F:\"}),\" \\u041D\\u0430\\u043F\\u043E\\u043C\\u0438\\u043D\\u0430\\u043D\\u0438\\u044F \\u0440\\u0435\\u0441\\u043F\\u043E\\u043D\\u0434\\u0435\\u043D\\u0442\\u0430\\u043C \\u0441 \\u043D\\u0435\\u0437\\u0430\\u0432\\u0435\\u0440\\u0448\\u0435\\u043D\\u043D\\u044B\\u043C\\u0438 \\u043E\\u0446\\u0435\\u043D\\u043A\\u0430\\u043C\\u0438\"]})]})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 shadow rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-5 sm:p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900 dark:text-white\",children:\"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438 \\u0438\\u043D\\u0442\\u0435\\u0433\\u0440\\u0430\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"\\u041F\\u0435\\u0440\\u0435\\u043C\\u0435\\u043D\\u043D\\u044B\\u0435 \\u043E\\u043A\\u0440\\u0443\\u0436\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u0414\\u043B\\u044F \\u043D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438 \\u0438\\u043D\\u0442\\u0435\\u0433\\u0440\\u0430\\u0446\\u0438\\u0438 \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E \\u0443\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0441\\u043B\\u0435\\u0434\\u0443\\u044E\\u0449\\u0438\\u0435 \\u043F\\u0435\\u0440\\u0435\\u043C\\u0435\\u043D\\u043D\\u044B\\u0435:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"mt-2 space-y-1 list-disc list-inside\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"code\",{className:\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\",children:\"MATTERMOST_URL\"}),\" - URL \\u0432\\u0430\\u0448\\u0435\\u0433\\u043E Mattermost \\u0441\\u0435\\u0440\\u0432\\u0435\\u0440\\u0430\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"code\",{className:\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\",children:\"MATTERMOST_TOKEN\"}),\" - Personal Access Token\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"code\",{className:\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\",children:\"MATTERMOST_TEAM_ID\"}),\" - ID \\u043A\\u043E\\u043C\\u0430\\u043D\\u0434\\u044B\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"code\",{className:\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\",children:\"MATTERMOST_BOT_USERNAME\"}),\" - \\u0418\\u043C\\u044F \\u0431\\u043E\\u0442\\u0430 (\\u043E\\u043F\\u0446\\u0438\\u043E\\u043D\\u0430\\u043B\\u044C\\u043D\\u043E)\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"\\u0410\\u0432\\u0442\\u043E\\u043C\\u0430\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u0438\\u0435 \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u0421\\u0438\\u0441\\u0442\\u0435\\u043C\\u0430 \\u0430\\u0432\\u0442\\u043E\\u043C\\u0430\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u0438 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u044F\\u0435\\u0442 \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F \\u0432 \\u0441\\u043B\\u0435\\u0434\\u0443\\u044E\\u0449\\u0438\\u0445 \\u0441\\u043B\\u0443\\u0447\\u0430\\u044F\\u0445:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"mt-2 space-y-1 list-disc list-inside\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u041F\\u0440\\u0438 \\u0437\\u0430\\u043F\\u0443\\u0441\\u043A\\u0435 \\u0446\\u0438\\u043A\\u043B\\u0430 \\u043E\\u0446\\u0435\\u043D\\u043A\\u0438 - \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0430\\u043C \\u0438 \\u0440\\u0435\\u0441\\u043F\\u043E\\u043D\\u0434\\u0435\\u043D\\u0442\\u0430\\u043C\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u041F\\u0440\\u0438 \\u0437\\u0430\\u0432\\u0435\\u0440\\u0448\\u0435\\u043D\\u0438\\u0438 \\u0432\\u0441\\u0435\\u0445 \\u043E\\u0446\\u0435\\u043D\\u043E\\u043A - \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0443 \\u0446\\u0438\\u043A\\u043B\\u0430\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u041D\\u0430\\u043F\\u043E\\u043C\\u0438\\u043D\\u0430\\u043D\\u0438\\u044F \\u043E \\u043D\\u0435\\u0437\\u0430\\u0432\\u0435\\u0440\\u0448\\u0435\\u043D\\u043D\\u044B\\u0445 \\u043E\\u0446\\u0435\\u043D\\u043A\\u0430\\u0445 (\\u043C\\u043E\\u0436\\u043D\\u043E \\u043D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0438\\u0442\\u044C)\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"\\u0421\\u0438\\u043D\\u0445\\u0440\\u043E\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u0414\\u043B\\u044F \\u043A\\u043E\\u0440\\u0440\\u0435\\u043A\\u0442\\u043D\\u043E\\u0439 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B \\u0443\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u0439 \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"mt-2 space-y-1 list-disc list-inside\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u0421\\u0438\\u043D\\u0445\\u0440\\u043E\\u043D\\u0438\\u0437\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439 \\u0441 Mattermost\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u0423\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C username \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439 \\u0432 Mattermost\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u0423\\u0431\\u0435\\u0434\\u0438\\u0442\\u044C\\u0441\\u044F, \\u0447\\u0442\\u043E \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0438 \\u043D\\u0430\\u0445\\u043E\\u0434\\u044F\\u0442\\u0441\\u044F \\u0432 \\u043E\\u0434\\u043D\\u043E\\u0439 \\u043A\\u043E\\u043C\\u0430\\u043D\\u0434\\u0435\"})]})]})]})]})})]})})]});};export default AdminMattermost;","map":{"version":3,"names":["React","useState","useEffect","api","jsx","_jsx","jsxs","_jsxs","AdminMattermost","stats","setStats","loading","setLoading","error","setError","successMessage","setSuccessMessage","syncing","setSyncing","testing","setTesting","cycles","setCycles","selectedCycle","setSelectedCycle","sendingNotification","setSendingNotification","loadData","statsResponse","cyclesResponse","Promise","all","get","catch","data","filter","cycle","status","console","handleTestConnection","response","connected","_error$response","_error$response$data","handleSyncUsers","post","success","message","_error$response2","_error$response2$data","handleSendCycleNotification","cycleId","_error$response3","_error$response3$data","handleSendRespondentNotifications","_error$response4","_error$response4$data","handleSendReminders","_error$response5","_error$response5$data","timer","setTimeout","clearTimeout","className","children","connectionStatus","lastSync","onClick","disabled","users","total","withMattermost","syncPercentage","value","onChange","e","target","parseInt","map","id","title","name"],"sources":["/Users/chastnik/Documents/projects/360/frontend/src/pages/admin/AdminMattermost.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport api from '../../services/api';\n\ninterface MattermostStats {\n  connectionStatus: 'connected' | 'disconnected' | 'error';\n  lastSync: string | null;\n  users: {\n    total: number;\n    withMattermost: number;\n    syncPercentage: number;\n  };\n}\n\nexport const AdminMattermost: React.FC = () => {\n  const [stats, setStats] = useState<MattermostStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  const [syncing, setSyncing] = useState(false);\n  const [testing, setTesting] = useState(false);\n  const [cycles, setCycles] = useState<any[]>([]);\n  const [selectedCycle, setSelectedCycle] = useState<number | null>(null);\n  const [sendingNotification, setSendingNotification] = useState(false);\n\n  useEffect(() => {\n    loadData();\n  }, []);\n\n  const loadData = async () => {\n    try {\n      setLoading(true);\n      const [statsResponse, cyclesResponse] = await Promise.all([\n        api.get('/mattermost/integration-stats'),\n        api.get('/cycles').catch(() => ({ data: [] }))\n      ]);\n\n      setStats(statsResponse.data);\n      setCycles(cyclesResponse.data.filter((cycle: any) => cycle.status === 'active'));\n    } catch (error) {\n      console.error('Ошибка загрузки данных:', error);\n      setError('Не удалось загрузить данные интеграции');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleTestConnection = async () => {\n    try {\n      setTesting(true);\n      const response = await api.get('/mattermost/test-connection');\n      \n      if (response.data.connected) {\n        setSuccessMessage('Подключение к Mattermost работает корректно');\n      } else {\n        setError('Не удалось подключиться к Mattermost');\n      }\n      \n      loadData(); // Обновляем статистику\n    } catch (error: any) {\n      console.error('Ошибка тестирования подключения:', error);\n      setError(error.response?.data?.error || 'Ошибка тестирования подключения');\n    } finally {\n      setTesting(false);\n    }\n  };\n\n  const handleSyncUsers = async () => {\n    try {\n      setSyncing(true);\n      const response = await api.post('/mattermost/sync-users');\n      \n      if (response.data.success) {\n        setSuccessMessage(response.data.message);\n        loadData(); // Обновляем статистику\n      } else {\n        setError(response.data.error || 'Ошибка синхронизации пользователей');\n      }\n    } catch (error: any) {\n      console.error('Ошибка синхронизации пользователей:', error);\n      setError(error.response?.data?.error || 'Ошибка синхронизации пользователей');\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const handleSendCycleNotification = async (cycleId: number) => {\n    try {\n      setSendingNotification(true);\n      const response = await api.post(`/mattermost/notify-cycle-start/${cycleId}`);\n      \n      if (response.data.success) {\n        setSuccessMessage(response.data.message);\n      } else {\n        setError(response.data.error || 'Ошибка отправки уведомлений');\n      }\n    } catch (error: any) {\n      console.error('Ошибка отправки уведомлений:', error);\n      setError(error.response?.data?.error || 'Ошибка отправки уведомлений');\n    } finally {\n      setSendingNotification(false);\n    }\n  };\n\n  const handleSendRespondentNotifications = async (cycleId: number) => {\n    try {\n      setSendingNotification(true);\n      const response = await api.post(`/mattermost/notify-respondents/${cycleId}`);\n      \n      if (response.data.success) {\n        setSuccessMessage(response.data.message);\n      } else {\n        setError(response.data.error || 'Ошибка отправки уведомлений');\n      }\n    } catch (error: any) {\n      console.error('Ошибка отправки уведомлений:', error);\n      setError(error.response?.data?.error || 'Ошибка отправки уведомлений');\n    } finally {\n      setSendingNotification(false);\n    }\n  };\n\n  const handleSendReminders = async (cycleId: number) => {\n    try {\n      setSendingNotification(true);\n      const response = await api.post(`/mattermost/send-reminders/${cycleId}`);\n      \n      if (response.data.success) {\n        setSuccessMessage(response.data.message);\n      } else {\n        setError(response.data.error || 'Ошибка отправки напоминаний');\n      }\n    } catch (error: any) {\n      console.error('Ошибка отправки напоминаний:', error);\n      setError(error.response?.data?.error || 'Ошибка отправки напоминаний');\n    } finally {\n      setSendingNotification(false);\n    }\n  };\n\n  // Очистка сообщений через 5 секунд\n  useEffect(() => {\n    if (successMessage || error) {\n      const timer = setTimeout(() => {\n        setSuccessMessage(null);\n        setError(null);\n      }, 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [successMessage, error]);\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Заголовок */}\n      <div className=\"md:flex md:items-center md:justify-between\">\n        <div className=\"flex-1 min-w-0\">\n          <h1 className=\"text-2xl font-bold leading-7 text-gray-900 dark:text-white sm:text-3xl sm:truncate\">\n            Интеграция с Mattermost\n          </h1>\n          <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n            Управление интеграцией и уведомлениями через Mattermost\n          </p>\n        </div>\n      </div>\n\n      {/* Сообщения */}\n      {successMessage && (\n        <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded\">\n          {successMessage}\n        </div>\n      )}\n\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded\">\n          {error}\n        </div>\n      )}\n\n      {/* Статус подключения */}\n      <div className=\"bg-white dark:bg-gray-800 shadow rounded-lg\">\n        <div className=\"px-4 py-5 sm:p-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900 dark:text-white\">\n            Статус подключения\n          </h3>\n          <div className=\"mt-5\">\n            <div className=\"flex items-center\">\n              <div className={`flex-shrink-0 w-3 h-3 rounded-full ${\n                stats?.connectionStatus === 'connected' ? 'bg-green-500' : 'bg-red-500'\n              }`}></div>\n              <div className=\"ml-3\">\n                <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                  {stats?.connectionStatus === 'connected' ? 'Подключено' : 'Отключено'}\n                </p>\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                  {stats?.connectionStatus === 'connected' ? 'Последняя синхронизация: ' + (stats?.lastSync || 'никогда') : ''}\n                </p>\n              </div>\n            </div>\n            <div className=\"mt-4\">\n              <button\n                onClick={handleTestConnection}\n                disabled={testing}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {testing ? 'Тестирование...' : 'Тестировать подключение'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Статистика пользователей */}\n      <div className=\"bg-white dark:bg-gray-800 shadow rounded-lg\">\n        <div className=\"px-4 py-5 sm:p-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900 dark:text-white\">\n            Синхронизация пользователей\n          </h3>\n          <div className=\"mt-5\">\n            <div className=\"grid grid-cols-1 gap-5 sm:grid-cols-3\">\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\n                  Всего пользователей\n                </dt>\n                <dd className=\"mt-1 text-2xl font-semibold text-gray-900 dark:text-white\">\n                  {stats?.users.total || 0}\n                </dd>\n              </div>\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\n                  С Mattermost\n                </dt>\n                <dd className=\"mt-1 text-2xl font-semibold text-gray-900 dark:text-white\">\n                  {stats?.users.withMattermost || 0}\n                </dd>\n              </div>\n              <div>\n                <dt className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\n                  Процент синхронизации\n                </dt>\n                <dd className=\"mt-1 text-2xl font-semibold text-gray-900 dark:text-white\">\n                  {stats?.users.syncPercentage || 0}%\n                </dd>\n              </div>\n            </div>\n            <div className=\"mt-4\">\n              <button\n                onClick={handleSyncUsers}\n                disabled={syncing}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {syncing ? 'Синхронизация...' : 'Синхронизировать пользователей'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Уведомления */}\n      <div className=\"bg-white dark:bg-gray-800 shadow rounded-lg\">\n        <div className=\"px-4 py-5 sm:p-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900 dark:text-white\">\n            Отправка уведомлений\n          </h3>\n          <div className=\"mt-5\">\n            <div className=\"grid grid-cols-1 gap-5 sm:grid-cols-2\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Выберите цикл оценки\n                </label>\n                <select\n                  value={selectedCycle || ''}\n                  onChange={(e) => setSelectedCycle(e.target.value ? parseInt(e.target.value) : null)}\n                  className=\"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\n                >\n                  <option value=\"\">Выберите цикл...</option>\n                  {cycles.map(cycle => (\n                    <option key={cycle.id} value={cycle.id}>\n                      {cycle.title || cycle.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n            \n            {selectedCycle && (\n              <div className=\"mt-4 space-y-3\">\n                <div className=\"flex flex-wrap gap-3\">\n                  <button\n                    onClick={() => handleSendCycleNotification(selectedCycle)}\n                    disabled={sendingNotification}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {sendingNotification ? 'Отправка...' : 'Уведомить о запуске цикла'}\n                  </button>\n                  \n                  <button\n                    onClick={() => handleSendRespondentNotifications(selectedCycle)}\n                    disabled={sendingNotification}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {sendingNotification ? 'Отправка...' : 'Уведомить респондентов'}\n                  </button>\n                  \n                  <button\n                    onClick={() => handleSendReminders(selectedCycle)}\n                    disabled={sendingNotification}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {sendingNotification ? 'Отправка...' : 'Отправить напоминания'}\n                  </button>\n                </div>\n                \n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                  <p><strong>Уведомить о запуске цикла:</strong> Отправляет уведомления всем участникам цикла о начале оценки</p>\n                  <p><strong>Уведомить респондентов:</strong> Персональные уведомления респондентам о необходимости пройти оценку</p>\n                  <p><strong>Отправить напоминания:</strong> Напоминания респондентам с незавершенными оценками</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Настройки интеграции */}\n      <div className=\"bg-white dark:bg-gray-800 shadow rounded-lg\">\n        <div className=\"px-4 py-5 sm:p-6\">\n          <h3 className=\"text-lg leading-6 font-medium text-gray-900 dark:text-white\">\n            Настройки интеграции\n          </h3>\n          <div className=\"mt-5\">\n            <div className=\"space-y-4\">\n              <div>\n                <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                  Переменные окружения\n                </h4>\n                <div className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n                  <p>Для настройки интеграции необходимо указать следующие переменные:</p>\n                  <ul className=\"mt-2 space-y-1 list-disc list-inside\">\n                    <li><code className=\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">MATTERMOST_URL</code> - URL вашего Mattermost сервера</li>\n                    <li><code className=\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">MATTERMOST_TOKEN</code> - Personal Access Token</li>\n                    <li><code className=\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">MATTERMOST_TEAM_ID</code> - ID команды</li>\n                    <li><code className=\"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">MATTERMOST_BOT_USERNAME</code> - Имя бота (опционально)</li>\n                  </ul>\n                </div>\n              </div>\n              \n              <div>\n                <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                  Автоматические уведомления\n                </h4>\n                <div className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n                  <p>Система автоматически отправляет уведомления в следующих случаях:</p>\n                  <ul className=\"mt-2 space-y-1 list-disc list-inside\">\n                    <li>При запуске цикла оценки - участникам и респондентам</li>\n                    <li>При завершении всех оценок - участнику цикла</li>\n                    <li>Напоминания о незавершенных оценках (можно настроить)</li>\n                  </ul>\n                </div>\n              </div>\n              \n              <div>\n                <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                  Синхронизация пользователей\n                </h4>\n                <div className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n                  <p>Для корректной работы уведомлений необходимо:</p>\n                  <ul className=\"mt-2 space-y-1 list-disc list-inside\">\n                    <li>Синхронизировать пользователей с Mattermost</li>\n                    <li>Указать username пользователей в Mattermost</li>\n                    <li>Убедиться, что пользователи находятся в одной команде</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AdminMattermost; "],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,GAAG,KAAM,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAYrC,MAAO,MAAM,CAAAC,eAAyB,CAAGA,CAAA,GAAM,CAC7C,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGT,QAAQ,CAAyB,IAAI,CAAC,CAChE,KAAM,CAACU,OAAO,CAAEC,UAAU,CAAC,CAAGX,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACY,KAAK,CAAEC,QAAQ,CAAC,CAAGb,QAAQ,CAAgB,IAAI,CAAC,CACvD,KAAM,CAACc,cAAc,CAAEC,iBAAiB,CAAC,CAAGf,QAAQ,CAAgB,IAAI,CAAC,CACzE,KAAM,CAACgB,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACkB,OAAO,CAAEC,UAAU,CAAC,CAAGnB,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACoB,MAAM,CAAEC,SAAS,CAAC,CAAGrB,QAAQ,CAAQ,EAAE,CAAC,CAC/C,KAAM,CAACsB,aAAa,CAAEC,gBAAgB,CAAC,CAAGvB,QAAQ,CAAgB,IAAI,CAAC,CACvE,KAAM,CAACwB,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGzB,QAAQ,CAAC,KAAK,CAAC,CAErEC,SAAS,CAAC,IAAM,CACdyB,QAAQ,CAAC,CAAC,CACZ,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAA,QAAQ,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAI,CACFf,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAACgB,aAAa,CAAEC,cAAc,CAAC,CAAG,KAAM,CAAAC,OAAO,CAACC,GAAG,CAAC,CACxD5B,GAAG,CAAC6B,GAAG,CAAC,+BAA+B,CAAC,CACxC7B,GAAG,CAAC6B,GAAG,CAAC,SAAS,CAAC,CAACC,KAAK,CAAC,KAAO,CAAEC,IAAI,CAAE,EAAG,CAAC,CAAC,CAAC,CAC/C,CAAC,CAEFxB,QAAQ,CAACkB,aAAa,CAACM,IAAI,CAAC,CAC5BZ,SAAS,CAACO,cAAc,CAACK,IAAI,CAACC,MAAM,CAAEC,KAAU,EAAKA,KAAK,CAACC,MAAM,GAAK,QAAQ,CAAC,CAAC,CAClF,CAAE,MAAOxB,KAAK,CAAE,CACdyB,OAAO,CAACzB,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CAC/CC,QAAQ,CAAC,wCAAwC,CAAC,CACpD,CAAC,OAAS,CACRF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAA2B,oBAAoB,CAAG,KAAAA,CAAA,GAAY,CACvC,GAAI,CACFnB,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAoB,QAAQ,CAAG,KAAM,CAAArC,GAAG,CAAC6B,GAAG,CAAC,6BAA6B,CAAC,CAE7D,GAAIQ,QAAQ,CAACN,IAAI,CAACO,SAAS,CAAE,CAC3BzB,iBAAiB,CAAC,6CAA6C,CAAC,CAClE,CAAC,IAAM,CACLF,QAAQ,CAAC,sCAAsC,CAAC,CAClD,CAEAa,QAAQ,CAAC,CAAC,CAAE;AACd,CAAE,MAAOd,KAAU,CAAE,KAAA6B,eAAA,CAAAC,oBAAA,CACnBL,OAAO,CAACzB,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CACxDC,QAAQ,CAAC,EAAA4B,eAAA,CAAA7B,KAAK,CAAC2B,QAAQ,UAAAE,eAAA,kBAAAC,oBAAA,CAAdD,eAAA,CAAgBR,IAAI,UAAAS,oBAAA,iBAApBA,oBAAA,CAAsB9B,KAAK,GAAI,iCAAiC,CAAC,CAC5E,CAAC,OAAS,CACRO,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAwB,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClC,GAAI,CACF1B,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAsB,QAAQ,CAAG,KAAM,CAAArC,GAAG,CAAC0C,IAAI,CAAC,wBAAwB,CAAC,CAEzD,GAAIL,QAAQ,CAACN,IAAI,CAACY,OAAO,CAAE,CACzB9B,iBAAiB,CAACwB,QAAQ,CAACN,IAAI,CAACa,OAAO,CAAC,CACxCpB,QAAQ,CAAC,CAAC,CAAE;AACd,CAAC,IAAM,CACLb,QAAQ,CAAC0B,QAAQ,CAACN,IAAI,CAACrB,KAAK,EAAI,oCAAoC,CAAC,CACvE,CACF,CAAE,MAAOA,KAAU,CAAE,KAAAmC,gBAAA,CAAAC,qBAAA,CACnBX,OAAO,CAACzB,KAAK,CAAC,qCAAqC,CAAEA,KAAK,CAAC,CAC3DC,QAAQ,CAAC,EAAAkC,gBAAA,CAAAnC,KAAK,CAAC2B,QAAQ,UAAAQ,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBd,IAAI,UAAAe,qBAAA,iBAApBA,qBAAA,CAAsBpC,KAAK,GAAI,oCAAoC,CAAC,CAC/E,CAAC,OAAS,CACRK,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAgC,2BAA2B,CAAG,KAAO,CAAAC,OAAe,EAAK,CAC7D,GAAI,CACFzB,sBAAsB,CAAC,IAAI,CAAC,CAC5B,KAAM,CAAAc,QAAQ,CAAG,KAAM,CAAArC,GAAG,CAAC0C,IAAI,CAAC,kCAAkCM,OAAO,EAAE,CAAC,CAE5E,GAAIX,QAAQ,CAACN,IAAI,CAACY,OAAO,CAAE,CACzB9B,iBAAiB,CAACwB,QAAQ,CAACN,IAAI,CAACa,OAAO,CAAC,CAC1C,CAAC,IAAM,CACLjC,QAAQ,CAAC0B,QAAQ,CAACN,IAAI,CAACrB,KAAK,EAAI,6BAA6B,CAAC,CAChE,CACF,CAAE,MAAOA,KAAU,CAAE,KAAAuC,gBAAA,CAAAC,qBAAA,CACnBf,OAAO,CAACzB,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACpDC,QAAQ,CAAC,EAAAsC,gBAAA,CAAAvC,KAAK,CAAC2B,QAAQ,UAAAY,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBlB,IAAI,UAAAmB,qBAAA,iBAApBA,qBAAA,CAAsBxC,KAAK,GAAI,6BAA6B,CAAC,CACxE,CAAC,OAAS,CACRa,sBAAsB,CAAC,KAAK,CAAC,CAC/B,CACF,CAAC,CAED,KAAM,CAAA4B,iCAAiC,CAAG,KAAO,CAAAH,OAAe,EAAK,CACnE,GAAI,CACFzB,sBAAsB,CAAC,IAAI,CAAC,CAC5B,KAAM,CAAAc,QAAQ,CAAG,KAAM,CAAArC,GAAG,CAAC0C,IAAI,CAAC,kCAAkCM,OAAO,EAAE,CAAC,CAE5E,GAAIX,QAAQ,CAACN,IAAI,CAACY,OAAO,CAAE,CACzB9B,iBAAiB,CAACwB,QAAQ,CAACN,IAAI,CAACa,OAAO,CAAC,CAC1C,CAAC,IAAM,CACLjC,QAAQ,CAAC0B,QAAQ,CAACN,IAAI,CAACrB,KAAK,EAAI,6BAA6B,CAAC,CAChE,CACF,CAAE,MAAOA,KAAU,CAAE,KAAA0C,gBAAA,CAAAC,qBAAA,CACnBlB,OAAO,CAACzB,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACpDC,QAAQ,CAAC,EAAAyC,gBAAA,CAAA1C,KAAK,CAAC2B,QAAQ,UAAAe,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBrB,IAAI,UAAAsB,qBAAA,iBAApBA,qBAAA,CAAsB3C,KAAK,GAAI,6BAA6B,CAAC,CACxE,CAAC,OAAS,CACRa,sBAAsB,CAAC,KAAK,CAAC,CAC/B,CACF,CAAC,CAED,KAAM,CAAA+B,mBAAmB,CAAG,KAAO,CAAAN,OAAe,EAAK,CACrD,GAAI,CACFzB,sBAAsB,CAAC,IAAI,CAAC,CAC5B,KAAM,CAAAc,QAAQ,CAAG,KAAM,CAAArC,GAAG,CAAC0C,IAAI,CAAC,8BAA8BM,OAAO,EAAE,CAAC,CAExE,GAAIX,QAAQ,CAACN,IAAI,CAACY,OAAO,CAAE,CACzB9B,iBAAiB,CAACwB,QAAQ,CAACN,IAAI,CAACa,OAAO,CAAC,CAC1C,CAAC,IAAM,CACLjC,QAAQ,CAAC0B,QAAQ,CAACN,IAAI,CAACrB,KAAK,EAAI,6BAA6B,CAAC,CAChE,CACF,CAAE,MAAOA,KAAU,CAAE,KAAA6C,gBAAA,CAAAC,qBAAA,CACnBrB,OAAO,CAACzB,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACpDC,QAAQ,CAAC,EAAA4C,gBAAA,CAAA7C,KAAK,CAAC2B,QAAQ,UAAAkB,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBxB,IAAI,UAAAyB,qBAAA,iBAApBA,qBAAA,CAAsB9C,KAAK,GAAI,6BAA6B,CAAC,CACxE,CAAC,OAAS,CACRa,sBAAsB,CAAC,KAAK,CAAC,CAC/B,CACF,CAAC,CAED;AACAxB,SAAS,CAAC,IAAM,CACd,GAAIa,cAAc,EAAIF,KAAK,CAAE,CAC3B,KAAM,CAAA+C,KAAK,CAAGC,UAAU,CAAC,IAAM,CAC7B7C,iBAAiB,CAAC,IAAI,CAAC,CACvBF,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAC,CAAE,IAAI,CAAC,CACR,MAAO,IAAMgD,YAAY,CAACF,KAAK,CAAC,CAClC,CACF,CAAC,CAAE,CAAC7C,cAAc,CAAEF,KAAK,CAAC,CAAC,CAE3B,GAAIF,OAAO,CAAE,CACX,mBACEN,IAAA,QAAK0D,SAAS,CAAC,uCAAuC,CAAAC,QAAA,cACpD3D,IAAA,QAAK0D,SAAS,CAAC,mEAAmE,CAAM,CAAC,CACtF,CAAC,CAEV,CAEA,mBACExD,KAAA,QAAKwD,SAAS,CAAC,WAAW,CAAAC,QAAA,eAExB3D,IAAA,QAAK0D,SAAS,CAAC,4CAA4C,CAAAC,QAAA,cACzDzD,KAAA,QAAKwD,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B3D,IAAA,OAAI0D,SAAS,CAAC,oFAAoF,CAAAC,QAAA,CAAC,gFAEnG,CAAI,CAAC,cACL3D,IAAA,MAAG0D,SAAS,CAAC,+CAA+C,CAAAC,QAAA,CAAC,iQAE7D,CAAG,CAAC,EACD,CAAC,CACH,CAAC,CAGLjD,cAAc,eACbV,IAAA,QAAK0D,SAAS,CAAC,sEAAsE,CAAAC,QAAA,CAClFjD,cAAc,CACZ,CACN,CAEAF,KAAK,eACJR,IAAA,QAAK0D,SAAS,CAAC,gEAAgE,CAAAC,QAAA,CAC5EnD,KAAK,CACH,CACN,cAGDR,IAAA,QAAK0D,SAAS,CAAC,6CAA6C,CAAAC,QAAA,cAC1DzD,KAAA,QAAKwD,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/B3D,IAAA,OAAI0D,SAAS,CAAC,6DAA6D,CAAAC,QAAA,CAAC,yGAE5E,CAAI,CAAC,cACLzD,KAAA,QAAKwD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBzD,KAAA,QAAKwD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAChC3D,IAAA,QAAK0D,SAAS,CAAE,sCACd,CAAAtD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEwD,gBAAgB,IAAK,WAAW,CAAG,cAAc,CAAG,YAAY,EACtE,CAAM,CAAC,cACV1D,KAAA,QAAKwD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnB3D,IAAA,MAAG0D,SAAS,CAAC,mDAAmD,CAAAC,QAAA,CAC7D,CAAAvD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEwD,gBAAgB,IAAK,WAAW,CAAG,YAAY,CAAG,WAAW,CACpE,CAAC,cACJ5D,IAAA,MAAG0D,SAAS,CAAC,0CAA0C,CAAAC,QAAA,CACpD,CAAAvD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEwD,gBAAgB,IAAK,WAAW,CAAG,2BAA2B,EAAI,CAAAxD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEyD,QAAQ,GAAI,SAAS,CAAC,CAAG,EAAE,CAC3G,CAAC,EACD,CAAC,EACH,CAAC,cACN7D,IAAA,QAAK0D,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnB3D,IAAA,WACE8D,OAAO,CAAE5B,oBAAqB,CAC9B6B,QAAQ,CAAEjD,OAAQ,CAClB4C,SAAS,CAAC,iRAAiR,CAAAC,QAAA,CAE1R7C,OAAO,CAAG,iBAAiB,CAAG,yBAAyB,CAClD,CAAC,CACN,CAAC,EACH,CAAC,EACH,CAAC,CACH,CAAC,cAGNd,IAAA,QAAK0D,SAAS,CAAC,6CAA6C,CAAAC,QAAA,cAC1DzD,KAAA,QAAKwD,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/B3D,IAAA,OAAI0D,SAAS,CAAC,6DAA6D,CAAAC,QAAA,CAAC,+JAE5E,CAAI,CAAC,cACLzD,KAAA,QAAKwD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBzD,KAAA,QAAKwD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,eACpDzD,KAAA,QAAAyD,QAAA,eACE3D,IAAA,OAAI0D,SAAS,CAAC,sDAAsD,CAAAC,QAAA,CAAC,+GAErE,CAAI,CAAC,cACL3D,IAAA,OAAI0D,SAAS,CAAC,2DAA2D,CAAAC,QAAA,CACtE,CAAAvD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAE4D,KAAK,CAACC,KAAK,GAAI,CAAC,CACtB,CAAC,EACF,CAAC,cACN/D,KAAA,QAAAyD,QAAA,eACE3D,IAAA,OAAI0D,SAAS,CAAC,sDAAsD,CAAAC,QAAA,CAAC,mBAErE,CAAI,CAAC,cACL3D,IAAA,OAAI0D,SAAS,CAAC,2DAA2D,CAAAC,QAAA,CACtE,CAAAvD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAE4D,KAAK,CAACE,cAAc,GAAI,CAAC,CAC/B,CAAC,EACF,CAAC,cACNhE,KAAA,QAAAyD,QAAA,eACE3D,IAAA,OAAI0D,SAAS,CAAC,sDAAsD,CAAAC,QAAA,CAAC,2HAErE,CAAI,CAAC,cACLzD,KAAA,OAAIwD,SAAS,CAAC,2DAA2D,CAAAC,QAAA,EACtE,CAAAvD,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAE4D,KAAK,CAACG,cAAc,GAAI,CAAC,CAAC,GACpC,EAAI,CAAC,EACF,CAAC,EACH,CAAC,cACNnE,IAAA,QAAK0D,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnB3D,IAAA,WACE8D,OAAO,CAAEvB,eAAgB,CACzBwB,QAAQ,CAAEnD,OAAQ,CAClB8C,SAAS,CAAC,2QAA2Q,CAAAC,QAAA,CAEpR/C,OAAO,CAAG,kBAAkB,CAAG,gCAAgC,CAC1D,CAAC,CACN,CAAC,EACH,CAAC,EACH,CAAC,CACH,CAAC,cAGNZ,IAAA,QAAK0D,SAAS,CAAC,6CAA6C,CAAAC,QAAA,cAC1DzD,KAAA,QAAKwD,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/B3D,IAAA,OAAI0D,SAAS,CAAC,6DAA6D,CAAAC,QAAA,CAAC,qHAE5E,CAAI,CAAC,cACLzD,KAAA,QAAKwD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnB3D,IAAA,QAAK0D,SAAS,CAAC,uCAAuC,CAAAC,QAAA,cACpDzD,KAAA,QAAAyD,QAAA,eACE3D,IAAA,UAAO0D,SAAS,CAAC,iEAAiE,CAAAC,QAAA,CAAC,gHAEnF,CAAO,CAAC,cACRzD,KAAA,WACEkE,KAAK,CAAElD,aAAa,EAAI,EAAG,CAC3BmD,QAAQ,CAAGC,CAAC,EAAKnD,gBAAgB,CAACmD,CAAC,CAACC,MAAM,CAACH,KAAK,CAAGI,QAAQ,CAACF,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAG,IAAI,CAAE,CACpFV,SAAS,CAAC,0KAA0K,CAAAC,QAAA,eAEpL3D,IAAA,WAAQoE,KAAK,CAAC,EAAE,CAAAT,QAAA,CAAC,8EAAgB,CAAQ,CAAC,CACzC3C,MAAM,CAACyD,GAAG,CAAC1C,KAAK,eACf/B,IAAA,WAAuBoE,KAAK,CAAErC,KAAK,CAAC2C,EAAG,CAAAf,QAAA,CACpC5B,KAAK,CAAC4C,KAAK,EAAI5C,KAAK,CAAC6C,IAAI,EADf7C,KAAK,CAAC2C,EAEX,CACT,CAAC,EACI,CAAC,EACN,CAAC,CACH,CAAC,CAELxD,aAAa,eACZhB,KAAA,QAAKwD,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BzD,KAAA,QAAKwD,SAAS,CAAC,sBAAsB,CAAAC,QAAA,eACnC3D,IAAA,WACE8D,OAAO,CAAEA,CAAA,GAAMjB,2BAA2B,CAAC3B,aAAa,CAAE,CAC1D6C,QAAQ,CAAE3C,mBAAoB,CAC9BsC,SAAS,CAAC,wQAAwQ,CAAAC,QAAA,CAEjRvC,mBAAmB,CAAG,aAAa,CAAG,2BAA2B,CAC5D,CAAC,cAETpB,IAAA,WACE8D,OAAO,CAAEA,CAAA,GAAMb,iCAAiC,CAAC/B,aAAa,CAAE,CAChE6C,QAAQ,CAAE3C,mBAAoB,CAC9BsC,SAAS,CAAC,2QAA2Q,CAAAC,QAAA,CAEpRvC,mBAAmB,CAAG,aAAa,CAAG,wBAAwB,CACzD,CAAC,cAETpB,IAAA,WACE8D,OAAO,CAAEA,CAAA,GAAMV,mBAAmB,CAAClC,aAAa,CAAE,CAClD6C,QAAQ,CAAE3C,mBAAoB,CAC9BsC,SAAS,CAAC,8QAA8Q,CAAAC,QAAA,CAEvRvC,mBAAmB,CAAG,aAAa,CAAG,uBAAuB,CACxD,CAAC,EACN,CAAC,cAENlB,KAAA,QAAKwD,SAAS,CAAC,0CAA0C,CAAAC,QAAA,eACvDzD,KAAA,MAAAyD,QAAA,eAAG3D,IAAA,WAAA2D,QAAA,CAAQ,0IAA0B,CAAQ,CAAC,yUAA6D,EAAG,CAAC,cAC/GzD,KAAA,MAAAyD,QAAA,eAAG3D,IAAA,WAAA2D,QAAA,CAAQ,kIAAuB,CAAQ,CAAC,wXAAoE,EAAG,CAAC,cACnHzD,KAAA,MAAAyD,QAAA,eAAG3D,IAAA,WAAA2D,QAAA,CAAQ,4HAAsB,CAAQ,CAAC,4RAAmD,EAAG,CAAC,EAC9F,CAAC,EACH,CACN,EACE,CAAC,EACH,CAAC,CACH,CAAC,cAGN3D,IAAA,QAAK0D,SAAS,CAAC,6CAA6C,CAAAC,QAAA,cAC1DzD,KAAA,QAAKwD,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/B3D,IAAA,OAAI0D,SAAS,CAAC,6DAA6D,CAAAC,QAAA,CAAC,qHAE5E,CAAI,CAAC,cACL3D,IAAA,QAAK0D,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnBzD,KAAA,QAAKwD,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxBzD,KAAA,QAAAyD,QAAA,eACE3D,IAAA,OAAI0D,SAAS,CAAC,sDAAsD,CAAAC,QAAA,CAAC,qHAErE,CAAI,CAAC,cACLzD,KAAA,QAAKwD,SAAS,CAAC,+CAA+C,CAAAC,QAAA,eAC5D3D,IAAA,MAAA2D,QAAA,CAAG,qWAAiE,CAAG,CAAC,cACxEzD,KAAA,OAAIwD,SAAS,CAAC,sCAAsC,CAAAC,QAAA,eAClDzD,KAAA,OAAAyD,QAAA,eAAI3D,IAAA,SAAM0D,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAC,gBAAc,CAAM,CAAC,oGAAgC,EAAI,CAAC,cAC/HzD,KAAA,OAAAyD,QAAA,eAAI3D,IAAA,SAAM0D,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAC,kBAAgB,CAAM,CAAC,2BAAwB,EAAI,CAAC,cACzHzD,KAAA,OAAAyD,QAAA,eAAI3D,IAAA,SAAM0D,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAC,oBAAkB,CAAM,CAAC,mDAAa,EAAI,CAAC,cAChHzD,KAAA,OAAAyD,QAAA,eAAI3D,IAAA,SAAM0D,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAC,yBAAuB,CAAM,CAAC,sHAAyB,EAAI,CAAC,EAC/H,CAAC,EACF,CAAC,EACH,CAAC,cAENzD,KAAA,QAAAyD,QAAA,eACE3D,IAAA,OAAI0D,SAAS,CAAC,sDAAsD,CAAAC,QAAA,CAAC,yJAErE,CAAI,CAAC,cACLzD,KAAA,QAAKwD,SAAS,CAAC,+CAA+C,CAAAC,QAAA,eAC5D3D,IAAA,MAAA2D,QAAA,CAAG,qWAAiE,CAAG,CAAC,cACxEzD,KAAA,OAAIwD,SAAS,CAAC,sCAAsC,CAAAC,QAAA,eAClD3D,IAAA,OAAA2D,QAAA,CAAI,kRAAoD,CAAI,CAAC,cAC7D3D,IAAA,OAAA2D,QAAA,CAAI,uOAA4C,CAAI,CAAC,cACrD3D,IAAA,OAAA2D,QAAA,CAAI,6RAAqD,CAAI,CAAC,EAC5D,CAAC,EACF,CAAC,EACH,CAAC,cAENzD,KAAA,QAAAyD,QAAA,eACE3D,IAAA,OAAI0D,SAAS,CAAC,sDAAsD,CAAAC,QAAA,CAAC,+JAErE,CAAI,CAAC,cACLzD,KAAA,QAAKwD,SAAS,CAAC,+CAA+C,CAAAC,QAAA,eAC5D3D,IAAA,MAAA2D,QAAA,CAAG,uPAA6C,CAAG,CAAC,cACpDzD,KAAA,OAAIwD,SAAS,CAAC,sCAAsC,CAAAC,QAAA,eAClD3D,IAAA,OAAA2D,QAAA,CAAI,mMAA2C,CAAI,CAAC,cACpD3D,IAAA,OAAA2D,QAAA,CAAI,sJAA2C,CAAI,CAAC,cACpD3D,IAAA,OAAA2D,QAAA,CAAI,6RAAqD,CAAI,CAAC,EAC5D,CAAC,EACF,CAAC,EACH,CAAC,EACH,CAAC,CACH,CAAC,EACH,CAAC,CACH,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAxD,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}