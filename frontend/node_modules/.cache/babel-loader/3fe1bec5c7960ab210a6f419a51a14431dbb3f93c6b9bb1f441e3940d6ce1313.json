{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState,useCallback}from'react';import{useNavigate}from'react-router-dom';import{authAPI}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(null);const[isLoading,setIsLoading]=useState(true);const navigate=useNavigate();const isAuthenticated=!!user&&!!token;const loadUser=useCallback(async authToken=>{try{const response=await authAPI.getCurrentUser(authToken);if(response.success&&response.data){setUser(response.data);}else{throw new Error(response.error||'Не удалось загрузить пользователя');}}catch(error){console.error('Ошибка загрузки пользователя:',error);localStorage.removeItem('auth_token');setToken(null);setUser(null);}finally{setIsLoading(false);}},[]);useEffect(()=>{const savedToken=localStorage.getItem('auth_token');if(savedToken){setToken(savedToken);loadUser(savedToken);}else{setIsLoading(false);}},[loadUser]);const login=async(email,password)=>{try{setIsLoading(true);const response=await authAPI.login(email,password);if(response.success&&response.data){const{token:authToken,user:userData}=response.data;setToken(authToken);setUser(userData);localStorage.setItem('auth_token',authToken);console.log('Добро пожаловать!');navigate('/dashboard');}else{throw new Error(response.error||'Ошибка авторизации');}}catch(error){console.error('Login error:',error);console.error(error.message||'Ошибка авторизации');throw error;}finally{setIsLoading(false);}};const register=async userData=>{try{setIsLoading(true);const response=await authAPI.register(userData);if(response.success){console.log('Регистрация успешна! Пароль отправлен в Mattermost.');navigate('/login');}else{throw new Error(response.error||'Ошибка регистрации');}}catch(error){console.error('Registration error:',error);console.error(error.message||'Ошибка регистрации');throw error;}finally{setIsLoading(false);}};const logout=()=>{setUser(null);setToken(null);localStorage.removeItem('auth_token');console.log('Вы вышли из системы');navigate('/login');};const value={user,token,login,logout,register,isLoading,isAuthenticated};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","useNavigate","authAPI","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","token","setToken","isLoading","setIsLoading","navigate","isAuthenticated","loadUser","authToken","response","getCurrentUser","success","data","error","console","localStorage","removeItem","savedToken","getItem","login","email","password","userData","setItem","log","message","register","logout","value","Provider"],"sources":["/Users/chastnik/Documents/projects/360/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { authAPI } from '../services/api';\n\ninterface User {\n  id: string;\n  email: string;\n  first_name: string;\n  last_name: string;\n  middle_name?: string;\n  role: 'admin' | 'manager' | 'user';\n  position?: string;\n  department?: string;\n  manager_id?: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  token: string | null;\n  login: (email: string, password: string) => Promise<void>;\n  logout: () => void;\n  register: (userData: RegisterData) => Promise<void>;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n}\n\ninterface RegisterData {\n  email: string;\n  first_name: string;\n  last_name: string;\n  middle_name?: string;\n  mattermost_username?: string;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\ninterface AuthProviderProps {\n  children: React.ReactNode;\n}\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [token, setToken] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const navigate = useNavigate();\n\n  const isAuthenticated = !!user && !!token;\n\n  const loadUser = useCallback(async (authToken: string) => {\n    try {\n      const response = await authAPI.getCurrentUser(authToken);\n      if (response.success && response.data) {\n        setUser(response.data);\n      } else {\n        throw new Error(response.error || 'Не удалось загрузить пользователя');\n      }\n    } catch (error) {\n      console.error('Ошибка загрузки пользователя:', error);\n      localStorage.removeItem('auth_token');\n      setToken(null);\n      setUser(null);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    const savedToken = localStorage.getItem('auth_token');\n    if (savedToken) {\n      setToken(savedToken);\n      loadUser(savedToken);\n    } else {\n      setIsLoading(false);\n    }\n  }, [loadUser]);\n\n  const login = async (email: string, password: string) => {\n    try {\n      setIsLoading(true);\n      const response = await authAPI.login(email, password);\n      \n      if (response.success && response.data) {\n        const { token: authToken, user: userData } = response.data;\n        setToken(authToken);\n        setUser(userData);\n        localStorage.setItem('auth_token', authToken);\n        \n        console.log('Добро пожаловать!');\n        navigate('/dashboard');\n      } else {\n        throw new Error(response.error || 'Ошибка авторизации');\n      }\n    } catch (error: any) {\n      console.error('Login error:', error);\n      console.error(error.message || 'Ошибка авторизации');\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const register = async (userData: RegisterData) => {\n    try {\n      setIsLoading(true);\n      const response = await authAPI.register(userData);\n      \n      if (response.success) {\n        console.log('Регистрация успешна! Пароль отправлен в Mattermost.');\n        navigate('/login');\n      } else {\n        throw new Error(response.error || 'Ошибка регистрации');\n      }\n    } catch (error: any) {\n      console.error('Registration error:', error);\n      console.error(error.message || 'Ошибка регистрации');\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    localStorage.removeItem('auth_token');\n    console.log('Вы вышли из системы');\n    navigate('/login');\n  };\n\n  const value = {\n    user,\n    token,\n    login,\n    logout,\n    register,\n    isLoading,\n    isAuthenticated,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}