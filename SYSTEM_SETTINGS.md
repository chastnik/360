# Системные настройки

## Обзор

В приложении 360° оценки теперь доступна система управления конфигурацией через веб-интерфейс. Администраторы могут настраивать подключения к PostgreSQL и Redis, а также другие параметры системы прямо из админ-панели.

## Функции

### ✅ Настройка базы данных PostgreSQL
- Хост и порт сервера
- Имя базы данных
- Пользователь и пароль
- Тестирование подключения

### ✅ Настройка кэширования Redis
- Включение/выключение кэширования
- Хост и порт Redis сервера  
- Пароль для аутентификации
- Номер базы данных Redis
- Тестирование подключения

### ✅ Общие настройки
- Название системы и компании
- Email администратора
- Часовой пояс
- Настройки оценки по умолчанию

### ✅ Настройки уведомлений
- Email и Mattermost уведомления
- Настройки напоминаний

### ✅ Настройки безопасности
- Время сессии
- Политика паролей
- Ограничения входа

## Использование

### Доступ к настройкам

1. Войдите в систему как администратор
2. Перейдите в раздел "Администрирование"
3. Выберите "Настройки системы"

### Настройка базы данных

1. Перейдите на вкладку "База данных"
2. Введите параметры подключения к PostgreSQL:
   - **Хост**: IP адрес или доменное имя сервера БД
   - **Порт**: Порт сервера (по умолчанию 5432)
   - **Имя БД**: Название базы данных
   - **Пользователь**: Имя пользователя БД
   - **Пароль**: Пароль пользователя
3. Нажмите "Тестировать подключение" для проверки
4. Сохраните настройки

### Настройка Redis

1. Перейдите на вкладку "Кэширование"
2. Включите "Redis кэширование" если нужно
3. Введите параметры подключения:
   - **Хост**: IP адрес или доменное имя Redis сервера
   - **Порт**: Порт сервера (по умолчанию 6379)
   - **Пароль**: Пароль (опционально)
   - **База данных**: Номер БД Redis (0-15)
4. Нажмите "Тестировать подключение"
5. Сохраните настройки

## API Endpoints

### GET /api/settings
Получение всех настроек системы (только для админов)

```json
{
  "success": true,
  "settings": {
    "general": {
      "system_name": { "value": "Система 360° оценки", "type": "string" },
      ...
    },
    "database": {
      "db_host": { "value": "localhost", "type": "string" },
      "db_port": { "value": 5432, "type": "number" },
      ...
    },
    "cache": {
      "redis_enabled": { "value": true, "type": "boolean" },
      ...
    }
  }
}
```

### PUT /api/settings
Обновление настроек системы

```json
{
  "settings": {
    "database": {
      "db_host": "192.168.1.100",
      "db_port": 5432
    },
    "cache": {
      "redis_host": "redis.example.com",
      "redis_port": 6379
    }
  }
}
```

### POST /api/settings/test-database
Тестирование подключения к базе данных

```json
{
  "host": "localhost",
  "port": 5432,
  "database": "assessment_db",
  "username": "postgres",
  "password": "password"
}
```

### POST /api/settings/test-redis
Тестирование подключения к Redis

```json
{
  "host": "localhost",
  "port": 6379,
  "password": "",
  "db": 0
}
```

### POST /api/settings/reset
Сброс всех настроек к значениям по умолчанию

## Структура данных

### Таблица system_settings

| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | Уникальный идентификатор |
| setting_key | VARCHAR | Ключ настройки |
| setting_value | TEXT | Значение настройки |
| setting_type | VARCHAR | Тип данных (string, number, boolean, json) |
| description | TEXT | Описание настройки |
| category | VARCHAR | Категория (general, database, cache, notifications, security) |
| is_system | BOOLEAN | Системная настройка (нельзя удалить) |
| is_sensitive | BOOLEAN | Чувствительные данные (маскируются) |
| created_at | TIMESTAMP | Дата создания |
| updated_at | TIMESTAMP | Дата обновления |

## Безопасность

- Доступ к настройкам только для администраторов
- Чувствительные данные (пароли) маскируются в интерфейсе
- Все изменения логируются
- Проверка подключений изолирована

## Миграция

После первой установки системы:

1. Выполните миграцию базы данных:
```bash
cd backend && npm run migrate
```

2. Заполните настройки по умолчанию:
```bash
npm run seed
```

3. Перейдите в админ-панель и настройте подключения

## Примеры использования

### Подключение к внешней БД
```
Хост: db.company.com
Порт: 5432
БД: assessment_production
Пользователь: app_user
Пароль: SecurePassword123
```

### Подключение к Redis Cloud
```
Хост: redis-12345.cloud.redislabs.com
Порт: 12345
Пароль: your-redis-auth-token
База данных: 0
```

## Устранение неполадок

### Ошибка подключения к PostgreSQL
- Проверьте сетевую доступность хоста
- Убедитесь, что пользователь существует и имеет права
- Проверьте настройки файрволла
- Убедитесь, что PostgreSQL настроен на прием внешних подключений

### Ошибка подключения к Redis
- Проверьте доступность Redis сервера
- Убедитесь в правильности пароля
- Проверьте номер базы данных (0-15)
- Убедитесь, что Redis настроен для сетевых подключений

### Настройки не применяются
- Перезапустите приложение после изменения настроек БД
- Проверьте права доступа к настройкам (только админы)
- Убедитесь, что настройки успешно сохранены

## Развитие

Система настроек легко расширяется для добавления новых параметров:

1. Добавьте новые настройки в seed файл
2. Обновите интерфейс AdminSettings.tsx
3. Добавьте обработку в соответствующие сервисы 